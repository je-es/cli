'use strict';Object.defineProperty(exports,'__esModule',{value:true});var u=class h extends Error{constructor(t,e="CLI_ERROR"){super(t);this.code=e;this.name="CLIError",Error.captureStackTrace?.(this,h);}},g=class extends u{constructor(s){super(s,"VALIDATION_ERROR"),this.name="ValidationError";}},m=class extends u{constructor(s){super(`Command '${s}' not found`,"COMMAND_NOT_FOUND"),this.name="CommandNotFoundError";}},w=class{constructor(){this.tokens=[];this.position=0;}parse(s){this.tokens=s,this.position=0;let t={options:{},positional:[]};for(this.hasNext()&&!this.peek().startsWith("-")&&(t.command=this.consume());this.hasNext();){let e=this.consume();if(e.startsWith("--")){let[i,r]=e.slice(2).split("=");r!==void 0?t.options[i]=r:this.hasNext()&&!this.peek().startsWith("-")?t.options[i]=this.consume():t.options[i]=true;}else if(e.startsWith("-")&&e.length>1){let i=e.slice(1).split("");for(let r=0;r<i.length;r++){let c=i[r];r===i.length-1&&this.hasNext()&&!this.peek().startsWith("-")?t.options[c]=this.consume():t.options[c]=true;}}else t.positional.push(e);}return t}hasNext(){return this.position<this.tokens.length}peek(){return this.tokens[this.position]}consume(){return this.tokens[this.position++]}},y=class{constructor(s){this.commands=new Map;this.globalOptions=new Map;this.parser=new w;this.config=s,this.initializeCommands(),this.initializeGlobalOptions();}initializeCommands(){if(this.config.commands){for(let s of this.config.commands)if(this.commands.set(s.name,s),s.aliases)for(let t of s.aliases)this.commands.set(t,s);}}initializeGlobalOptions(){if(this.config.globalOptions){for(let s of this.config.globalOptions)if(this.globalOptions.set(s.name,s),this.globalOptions.set(s.flag,s),s.aliases)for(let t of s.aliases)this.globalOptions.set(t,s);}}async run(s=process.argv.slice(2)){try{let t=this.parser.parse(s);if(t.options.help||t.options.h){this.showHelp(t.command);return}if(!t.command){if(t.options.version||t.options.v){console.log(`${this.config.name} v${this.config.version}`);return}if(this.commands.size===0)throw new u("No command specified");this.showHelp();return}let e=this.commands.get(t.command);if(!e)throw new m(t.command);if(!e.options?.some(r=>r.flag==="-v"||r.aliases?.includes("-v"))&&(t.options.version||t.options.v)){console.log(`${this.config.name} v${this.config.version}`);return}if(e.allowDynamicArgs){let r=this.reparseForDynamicArgs(s,t.command),c=this.parseCommand(e,r.positional,r.options);e.action&&await e.action(c);}else {let r=this.parseCommand(e,t.positional,t.options);e.action&&await e.action(r);}}catch(t){this.handleError(t);}}reparseForDynamicArgs(s,t){let e=0;for(;e<s.length&&s[e]!==t;)e++;e++;let i=[],r={},c=this.commands.get(t),f=c?.args?.filter(o=>o.required!==false).length||0,d=0;for(;e<s.length;){let o=s[e];if(d<f&&!o.startsWith("-")){i.push(o),d++,e++;continue}if(o.startsWith("--")){let[n,a]=o.slice(2).split("=");c?.options?.some(p=>p.flag===`--${n}`||p.name===n||p.aliases?.includes(`--${n}`))?a!==void 0?r[n]=a:e+1<s.length&&!s[e+1].startsWith("-")?(r[n]=s[e+1],e++):r[n]=true:(i.push(o),a===void 0&&e+1<s.length&&!s[e+1].startsWith("-")&&(i.push(s[e+1]),e++));}else if(o.startsWith("-")&&o.length>1&&isNaN(Number(o))){let n=o.slice(1).split(""),a=true;for(let l of n)if(!c?.options?.some(O=>O.flag===`-${l}`||O.aliases?.includes(`-${l}`))){a=false;break}if(a)for(let l=0;l<n.length;l++){let p=n[l];l===n.length-1&&e+1<s.length&&!s[e+1].startsWith("-")?(r[p]=s[e+1],e++):r[p]=true;}else i.push(o),e+1<s.length&&!s[e+1].startsWith("-")&&(i.push(s[e+1]),e++);}else i.push(o);e++;}return {positional:i,options:r}}parseCommand(s,t,e){let i={args:{},options:{}},r=new Set;if(s.options)for(let o of s.options)r.add(o.name),r.add(o.flag.replace(/^-+/,"")),o.aliases&&o.aliases.forEach(n=>r.add(n.replace(/^-+/,"")));let c=0;if(s.args)for(let o=0;o<s.args.length;o++){let n=s.args[o],a=t[o];if(!a){if(n.required!==false)throw new g(`Missing required argument: ${n.name}`);i.args[n.name]=n.default;continue}if(n.validate){let l=n.validate(a);if(l!==true)throw new g(typeof l=="string"?l:`Invalid value for argument '${n.name}': ${a}`)}i.args[n.name]=a,c=o+1;}let f={},d=new Set;if(s.options)for(let o of s.options){let n=this.getOptionValue(o,e);if(n===void 0){if(o.required)throw new g(`Missing required option: --${o.name}`);i.options[o.name]=o.default;continue}let a=this.convertOptionType(n,o.type);if(o.validate){let l=o.validate(a);if(l!==true)throw new g(typeof l=="string"?l:`Invalid value for option '${o.name}': ${a}`)}i.options[o.name]=a;}for(let[o,n]of Object.entries(e))r.has(o)||(f[o]=n);if(s.allowDynamicOptions){let o=c;for(;o<t.length;){let n=t[o];if(n.startsWith("--")){let[a,l]=n.slice(2).split("=");d.add(o),l!==void 0?(f[a]=l,o++):o+1<t.length&&!t[o+1].startsWith("-")?(f[a]=t[o+1],d.add(o+1),o+=2):(f[a]=true,o++);}else if(n.startsWith("-")&&n.length>1&&isNaN(Number(n))){d.add(o);let a=n.slice(1).split("");for(let l=0;l<a.length;l++){let p=a[l];l===a.length-1&&o+1<t.length&&!t[o+1].startsWith("-")?(f[p]=t[o+1],d.add(o+1),o++):f[p]=true;}o++;}else o++;}}if(s.allowDynamicArgs){let o=[];for(let n=c;n<t.length;n++)d.has(n)||o.push(t[n]);i.dynamicArgs=o;}else if(t.length>c)throw new g(`Unexpected argument: ${t[c]}`);if(s.allowDynamicOptions)i.dynamicOptions=f;else if(Object.keys(f).length>0){let o=Object.keys(f)[0];throw new g(`Unknown option: ${o.length===1?"-":"--"}${o}`)}return i}getOptionValue(s,t){if(t[s.name]!==void 0)return t[s.name];let e=s.flag.replace(/^-+/,"");if(t[e]!==void 0)return t[e];if(s.aliases)for(let i of s.aliases){let r=i.replace(/^-+/,"");if(t[r]!==void 0)return t[r]}}convertOptionType(s,t){if(t==="number"){let e=Number(s);if(isNaN(e))throw new g(`Expected number, got: ${s}`);return e}return t==="boolean"?s===true||s==="true"?true:s===false||s==="false"?false:!!s:String(s)}showHelp(s){if(s){let e=this.commands.get(s);if(e){this.showCommandHelp(e);return}}console.log(`${this.config.name} v${this.config.version}`),this.config.description&&console.log(this.config.description),console.log(),console.log("USAGE:"),console.log(`  ${this.config.name} <command> [options]`),console.log(),console.log("COMMANDS:");let t=new Map;for(let[e,i]of this.commands)e===i.name&&t.set(e,i);for(let[e,i]of t){let r=i.aliases?` (${i.aliases.join(", ")})`:"";console.log(`  ${e}${r}`),i.description&&console.log(`    ${i.description}`);}console.log(),console.log("OPTIONS:"),console.log("  -h, --help       Show help"),console.log("  -v, --version    Show version");}showCommandHelp(s){console.log(`${s.name}`),s.description&&console.log(s.description),console.log();let t=`${this.config.name} ${s.name}`;if(s.args&&(t+=" "+s.args.map(e=>e.required!==false?`<${e.name}>`:`[${e.name}]`).join(" ")),s.allowDynamicArgs&&(t+=" [...]"),console.log("USAGE:"),console.log(`  ${t}`),console.log(),s.args&&s.args.length>0){console.log("ARGUMENTS:");for(let e of s.args){let i=e.required!==false?"required":"optional";console.log(`  ${e.name} (${i})`),e.description&&console.log(`    ${e.description}`);}s.allowDynamicArgs&&console.log("  ... (additional arguments allowed)"),console.log();}if(s.options&&s.options.length>0){console.log("OPTIONS:");for(let e of s.options){let i=e.aliases?`, ${e.aliases.join(", ")}`:"",r=e.required?" (required)":"";console.log(`  ${e.flag}${i}${r}`),e.description&&console.log(`    ${e.description}`);}}if(s.allowDynamicOptions&&console.log("  ... (additional options allowed)"),(s.options&&s.options.length>0||s.allowDynamicOptions)&&console.log(),s.examples&&s.examples.length>0){console.log("EXAMPLES:");for(let e of s.examples)console.log(`  ${e}`);console.log();}}handleError(s){s instanceof u?(console.error(`Error: ${s.message}`),process.exit(1)):s instanceof Error?(console.error(`Unexpected error: ${s.message}`),process.env.DEBUG&&console.error(s.stack),process.exit(1)):(console.error("An unknown error occurred"),process.exit(1));}},$=class{constructor(s,t){this.config={name:s,version:t,commands:[],globalOptions:[]};}description(s){return this.config.description=s,this}command(s){return this.config.commands||(this.config.commands=[]),this.config.commands.push(s),this}globalOption(s){return this.config.globalOptions||(this.config.globalOptions=[]),this.config.globalOptions.push(s),this}build(){return new y(this.config)}};function v(h,s){return new $(h,s)}var C=v;exports.CLI=y;exports.CLIBuilder=$;exports.CLIError=u;exports.CommandNotFoundError=m;exports.ValidationError=g;exports.cli=v;exports.default=C;//# sourceMappingURL=main.cjs.map
//# sourceMappingURL=main.cjs.map
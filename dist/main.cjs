'use strict';Object.defineProperty(exports,'__esModule',{value:true});var u=class{constructor(){this.tokens=[];this.position=0;}parse(s){this.tokens=s,this.position=0;let e={options:{},positional:[]};for(this.hasNext()&&!this.peek().startsWith("-")&&(e.command=this.consume());this.hasNext();){let o=this.consume();if(o.startsWith("--")){let[i,r]=o.slice(2).split("=");r!==void 0?e.options[i]=r:this.hasNext()&&!this.peek().startsWith("-")?e.options[i]=this.consume():e.options[i]=true;}else if(o.startsWith("-")&&o.length>1){let i=o.slice(1).split("");for(let r=0;r<i.length;r++){let c=i[r];r===i.length-1&&this.hasNext()&&!this.peek().startsWith("-")?e.options[c]=this.consume():e.options[c]=true;}}else e.positional.push(o);}return e}hasNext(){return this.position<this.tokens.length}peek(){return this.tokens[this.position]}consume(){return this.tokens[this.position++]}};var m=class d extends Error{constructor(e,o="CLI_ERROR"){super(e);this.code=o;this.name="CLIError",Error.captureStackTrace?.(this,d);}},f=class extends m{constructor(s){super(s,"VALIDATION_ERROR"),this.name="ValidationError";}},b=class extends m{constructor(s){super(`Command '${s}' not found`,"COMMAND_NOT_FOUND"),this.name="CommandNotFoundError";}};var y=class{constructor(s){this.config=s;this.commands=new Map;this.globalOptions=new Map;this.parser=new u;this.initializeCommands(),this.initializeGlobalOptions();}async run(s=process.argv.slice(2)){try{let e=this.parser.parse(s);if(e.options.help||e.options.h){this.showHelp(e.command);return}if(!e.command){if(e.options.version||e.options.v){console.log(`${this.config.name} v${this.config.version}`);return}if(this.commands.size===0)throw new m("No command specified");this.showHelp();return}let o=this.commands.get(e.command);if(!o)throw new b(e.command);if(!o.options?.some(r=>r.flag==="-v"||r.aliases?.includes("-v"))&&(e.options.version||e.options.v)){console.log(`${this.config.name} v${this.config.version}`);return}if(o.allowDynamicArgs){let r=this.reparseForDynamicArgs(s,e.command),c=this.parseCommand(o,r.positional,r.options);o.action&&await o.action(c);}else {let r=this.parseCommand(o,e.positional,e.options);o.action&&await o.action(r);}}catch(e){this.handleError(e);}}initializeCommands(){if(this.config.commands){for(let s of this.config.commands)if(this.commands.set(s.name,s),s.aliases)for(let e of s.aliases)this.commands.set(e,s);}}initializeGlobalOptions(){if(this.config.globalOptions){for(let s of this.config.globalOptions)if(this.globalOptions.set(s.name,s),this.globalOptions.set(s.flag,s),s.aliases)for(let e of s.aliases)this.globalOptions.set(e,s);}}reparseForDynamicArgs(s,e){let o=0;for(;o<s.length&&s[o]!==e;)o++;o++;let i=[],r={},c=this.commands.get(e),g=c?.args?.filter(n=>n.required!==false).length||0,h=0;for(;o<s.length;){let n=s[o];if(h<g&&!n.startsWith("-")){i.push(n),h++,o++;continue}if(n.startsWith("--")){let[t,l]=n.slice(2).split("=");c?.options?.some(p=>p.flag===`--${t}`||p.name===t||p.aliases?.includes(`--${t}`))?l!==void 0?r[t]=l:o+1<s.length&&!s[o+1].startsWith("-")?(r[t]=s[o+1],o++):r[t]=true:(i.push(n),l===void 0&&o+1<s.length&&!s[o+1].startsWith("-")&&(i.push(s[o+1]),o++));}else if(n.startsWith("-")&&n.length>1&&isNaN(Number(n))){let t=n.slice(1).split(""),l=true;for(let a of t)if(!c?.options?.some(C=>C.flag===`-${a}`||C.aliases?.includes(`-${a}`))){l=false;break}if(l)for(let a=0;a<t.length;a++){let p=t[a];a===t.length-1&&o+1<s.length&&!s[o+1].startsWith("-")?(r[p]=s[o+1],o++):r[p]=true;}else i.push(n),o+1<s.length&&!s[o+1].startsWith("-")&&(i.push(s[o+1]),o++);}else i.push(n);o++;}return {positional:i,options:r}}parseCommand(s,e,o){let i={args:{},options:{}},r=new Set;if(s.options)for(let n of s.options)r.add(n.name),r.add(n.flag.replace(/^-+/,"")),n.aliases&&n.aliases.forEach(t=>r.add(t.replace(/^-+/,"")));let c=0;if(s.args)for(let n=0;n<s.args.length;n++){let t=s.args[n],l=e[n];if(!l){if(t.required!==false)throw new f(`Missing required argument: ${t.name}`);i.args[t.name]=t.default??"";continue}if(t.validate){let a=t.validate(l);if(a!==true)throw new f(typeof a=="string"?a:`Invalid value for argument '${t.name}': ${l}`)}i.args[t.name]=l,c=n+1;}let g={},h=new Set;if(s.options)for(let n of s.options){let t=this.getOptionValue(n,o);if(t===void 0){if(n.required)throw new f(`Missing required option: --${n.name}`);i.options[n.name]=n.default??(n.type==="boolean"?false:"");continue}let l=this.convertOptionType(t,n.type);if(n.validate){let a=n.validate(l);if(a!==true)throw new f(typeof a=="string"?a:`Invalid value for option '${n.name}': ${l}`)}i.options[n.name]=l;}for(let[n,t]of Object.entries(o))r.has(n)||(g[n]=t);if(s.allowDynamicOptions){let n=c;for(;n<e.length;){let t=e[n];if(t.startsWith("--")){let[l,a]=t.slice(2).split("=");h.add(n),a!==void 0?(g[l]=a,n++):n+1<e.length&&!e[n+1].startsWith("-")?(g[l]=e[n+1],h.add(n+1),n+=2):(g[l]=true,n++);}else if(t.startsWith("-")&&t.length>1&&isNaN(Number(t))){h.add(n);let l=t.slice(1).split("");for(let a=0;a<l.length;a++){let p=l[a];a===l.length-1&&n+1<e.length&&!e[n+1].startsWith("-")?(g[p]=e[n+1],h.add(n+1),n++):g[p]=true;}n++;}else n++;}}if(s.allowDynamicArgs){let n=[];for(let t=c;t<e.length;t++)h.has(t)||n.push(e[t]);i.dynamicArgs=n;}else if(e.length>c)throw new f(`Unexpected argument: ${e[c]}`);if(s.allowDynamicOptions)i.dynamicOptions=g;else if(Object.keys(g).length>0){let n=Object.keys(g)[0];throw new f(`Unknown option: ${n.length===1?"-":"--"}${n}`)}return i}getOptionValue(s,e){if(e[s.name]!==void 0)return e[s.name];let o=s.flag.replace(/^-+/,"");if(e[o]!==void 0)return e[o];if(s.aliases)for(let i of s.aliases){let r=i.replace(/^-+/,"");if(e[r]!==void 0)return e[r]}}convertOptionType(s,e){if(e==="number"){let o=Number(s);if(isNaN(o))throw new f(`Expected number, got: ${s}`);return o}return e==="boolean"?s===true||s==="true"?true:s===false||s==="false"?false:!!s:String(s)}showHelp(s){if(s){let o=this.commands.get(s);if(o){this.showCommandHelp(o);return}}console.log(`${this.config.name} v${this.config.version}`),this.config.description&&console.log(this.config.description),console.log(),console.log("USAGE:"),console.log(`  ${this.config.name} <command> [options]`),console.log(),console.log("COMMANDS:");let e=new Map;for(let[o,i]of this.commands)o===i.name&&e.set(o,i);for(let[o,i]of e){let r=i.aliases?` (${i.aliases.join(", ")})`:"";console.log(`  ${o}${r}`),i.description&&console.log(`    ${i.description}`);}console.log(),console.log("OPTIONS:"),console.log("  -h, --help       Show help"),console.log("  -v, --version    Show version");}showCommandHelp(s){console.log(`${s.name}`),s.description&&console.log(s.description),console.log();let e=`${this.config.name} ${s.name}`;if(s.args&&(e+=" "+s.args.map(o=>o.required!==false?`<${o.name}>`:`[${o.name}]`).join(" ")),s.allowDynamicArgs&&(e+=" [...]"),console.log("USAGE:"),console.log(`  ${e}`),console.log(),s.args&&s.args.length>0){console.log("ARGUMENTS:");for(let o of s.args){let i=o.required!==false?"required":"optional";console.log(`  ${o.name} (${i})`),o.description&&console.log(`    ${o.description}`);}s.allowDynamicArgs&&console.log("  ... (additional arguments allowed)"),console.log();}if(s.options&&s.options.length>0){console.log("OPTIONS:");for(let o of s.options){let i=o.aliases?`, ${o.aliases.join(", ")}`:"",r=o.required?" (required)":"";console.log(`  ${o.flag}${i}${r}`),o.description&&console.log(`    ${o.description}`);}}if(s.allowDynamicOptions&&console.log("  ... (additional options allowed)"),(s.options&&s.options.length>0||s.allowDynamicOptions)&&console.log(),s.examples&&s.examples.length>0){console.log("EXAMPLES:");for(let o of s.examples)console.log(`  ${o}`);console.log();}}handleError(s){s instanceof m?(console.error(`Error: ${s.message}`),process.exit(1)):s instanceof Error?(console.error(`Unexpected error: ${s.message}`),process.env.DEBUG&&console.error(s.stack),process.exit(1)):(console.error("An unknown error occurred"),process.exit(1));}};var w=class{constructor(s,e){this.config={name:s,version:e,commands:[],globalOptions:[]};}description(s){return this.config.description=s,this}command(s){return this.config.commands||(this.config.commands=[]),this.config.commands.push(s),this}globalOption(s){return this.config.globalOptions||(this.config.globalOptions=[]),this.config.globalOptions.push(s),this}build(){return new y(this.config)}};function O(d,s){return new w(d,s)}var R=O;exports.Builder=w;exports.CLI=y;exports.CLIError=m;exports.CommandNotFoundError=b;exports.ValidationError=f;exports.cli=O;exports.default=R;//# sourceMappingURL=main.cjs.map
//# sourceMappingURL=main.cjs.map